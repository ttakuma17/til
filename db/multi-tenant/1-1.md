課題1-1
- 問題 
  - Where句を忘れただけで、見えてはいけない情報が見えてしまう状態でミスったときの影響が大きい
    - 人間なのでミスしうることを前提により堅牢な仕組みで防げるようにしたい
- 対策案
  1. 顧客の実行環境ごとにアプリケーション、DBを完全に分ける
     - メリット
       - 別の顧客の情報を見てしまうという可能性は減る
     - デメリット
       - サーバコストは顧客数に比例して増えていく
       - アプリケーション/インフラ管理の運用コストも増えていく
         - 各アプリケーション/各DBサーバに変更を適用する必要があるので、デプロイの手間が多くなるなど
  2. DBのみ顧客ごとに分ける
    - メリット
      - 1と比較するとサーバコストを抑えられる
      - アクセスしてきたユーザーがどの企業のものかを識別できていれば、他の企業の情報を見てしまうことはない
        - 企業ごとにDBのユーザーを分けてしまうことで、他の企業のデータへの権限的にさせないなど
    - デメリット
      - ユーザー識別のロジックはアプリケーション側で実装する必要がある
        - SQLの指定忘れによる問題が、アプリケーションのロジック側にうつっただけなので、これによってどこまで問題を防げるか
  3. データベースリソースは同じものを使うが、マルチテナントにしてRLSを使用する
     - メリット
       - 2よりもサーバコストを抑えられる
       - DB側の仕組みでテナントごとのリソース分離を担保できる
         - アプリケーションは頻繁に開発者が触るところなので、事故になりうる回数が増えるが、DBはアプリケーションと比較すると触る回数は少ないので事故の確率も減る
     - デメリット
       - RLS自体の学習コストが必要
         - 適用される条件が決まっているので、それを忘れるとRLSにはならない
       - 使用できるDBMSやバージョンが絞られる
結論
- 3の案を採用し、RLSを適切に設定する

参考
- https://speakerdeck.com/soudai/utilizing-rsl-in-multi-tenancy
- https://www.slideshare.net/AmazonWebServicesJapan/20220107-multi-tenant-database
- https://buildersbox.corp-sansan.com/entry/2021/05/10/110000
- https://mitomasan.hatenablog.com/entry/2016/05/25/210151
- https://aws.amazon.com/jp/blogs/news/multi-tenant-data-isolation-with-postgresql-row-level-security/