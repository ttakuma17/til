課題2-1
- CASCADE
  - 親テーブルのデータが削除されて、子テーブルにそのデータが同時に(物理)削除される必要がある場合。
- SET NULL
  - 親テーブルのデータが消されたタイミングで子テーブルの参照キーを必ず変更する必要がある場合
  - 子テーブル側のデータは残しておく必要があるとき
- RESTRICT
  - NO ACTIONと同じらしい。NO ACTIONのほうが一般的なので、そちらに書く
- NO ACTION
  - 親テーブルを削除しても、子テーブルのデータは更新する必要がない場合

課題2-2
- departmentを削除するとそれに紐づく、employeeがすべて物理削除されてしまう
  - 従業員の情報がすべて消えるので、従業員の部署で行った記録などの情報があった際にそれがなくなる
  - そもそも会社に所属しているのに、従業員情報が消えてしまうと、部署の廃止のたびに従業員情報の登録しなおしという実用に耐えない形になる

課題2-3
- Assigneeが削除されるとIssueの担当者がいなくなるため、要件を満たさなくなる。
  - assignee_idがnullになるので、許容できないケースが生まれる
  - データ上発生した場合も、過去のAsigneeを検索できない
  - 一切許容しないのであれば、Asigneeの削除のタイミングでIssueを削除するか、削除前に後任のAssigneeに更新する必要がある

課題2-4
Prisma
- https://www.prisma.io/docs/orm/prisma-schema/data-model/relations/referential-actions#referential-action-defaults
  - on delete 
    - Optional relations
      - Set Null
      - 外部キーのフィールドがNullを許容する関連の場合はこっちになる
      - 親テーブルのレコードが削除されたら、子テーブルのレコードがNullにする
    - Mandatory relations
      - Restrict
      - 外部キーのフィールドがNullを許容しない関連の場合はこっちになる
      - 親テーブルのレコードが削除しようとしたときに、子テーブルに外部キー制約があるレコードがあれば削除させない
  - 理由
    - データの整合性を重視しているので、Mandatory relationsの場合は不整合がおきないようにデフォルト値をRestrictにしている
    - 一方、Optional relationsはそもそもレコード自体がnullableなので、データ不整合が起きうる前提で関連だけ外すという設定にしている
drizzle
- https://orm.drizzle.team/docs/indexes-constraints
  - 基本的にDBMSのデフォルト値で決まる。ドキュメントには明示的にORM側で on delete の際のアクションは書いていない
  - 理由
    - Drizzle自体がORM固有の機能を強化するよりは、DBMSの仕様に基づいて操作するというような思想であるように感じる
    - そのため、Drizzle側で独自にデフォルト値の設定をせずにあくまでDBMSの考えを重視しているから

MySQLとPostgreSQLでのNoActionとRestrictの違い
- MySQL
  - https://dev.mysql.com/doc/refman/8.0/ja/create-table-foreign-keys.html#foreign-key-referential-actions
  - NoActionとRestrictは同義。参照するレコードがある場合、親テーブルのレコードの削除、更新を拒否する
- PostgreSQL
  - https://www.postgresql.jp/document/16/html/ddl-constraints.html
  - Restrict は親の削除/更新が即チェックされて、実行タイミングで拒否される
  - No Actions は、他のトリガーや制約がすべて評価されたあとにチェックされる