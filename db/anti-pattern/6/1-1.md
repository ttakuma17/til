課題1-1

# データベースのステータス管理に関するアンチパターン

## 1. 前提
- テーブル設計において、「どのようにテーブルを分けるか」「どのカラムにどの情報を格納するか」を考える。

## 2. アンチパターンの名前
**サーティーワンフレーバー**  
特定の値に限定する列定義を用いるアンチパターン。`ENUM` や `CHECK` 制約を利用し、ステータス値を固定する設計。

## 3. アンチパターンによる問題
- **拡張性の問題**  
  - 新しいステータスを追加するたびにテーブル定義の変更（Migration）が必要。
  - 例: 退学ステータスを追加する場合、スキーマ変更が発生する。
  - ロックの影響が許容できない場合、システムを停止して Migration を実施する必要がある。

- **デバッグの難しさ**  
  - `CHECK` 制約違反のエラーが発生した際に原因特定が難しい。
  - 例外処理でデータベース接続エラーと `CHECK` 制約違反を区別しにくい。

- **検索・パフォーマンスの問題**  
  - `WHERE` 句で頻繁に検索されるとパフォーマンスが低下する。
  - `INDEX` を貼ってもカーディナリティ（値の種類）が低い場合、効果が限定的。

- **運用コストの増加**  
  - アプリケーションやインフラ側で無理に対応しなければならなくなる。

- **履歴が残らない**  
  - 最新のステータスのみを保持するため、過去の状態を追跡できない。

## 4. アンチパターンを使うことを許容する条件
- ステータスの値が確実に変わらず、不変である場合。
  - **例**: `ON / OFF`, `IN / OUT`
- 値のセットが完全に相互排他的で増加しない場合。
  - **NG例**: 言語 (`日本語 / 英語`) → 中国語など新しい言語が追加される可能性があるため適さない。

## 5. 参考
- https://qiita.com/fktnkit/items/ada64c6581b676d250bb
- https://zenn.dev/tanakanata7190/books/55d484e6dc8b09/viewer/6d111a
- https://techblog.gmo-ap.jp/2021/06/23/sql-antipattern-1/#3-2
- https://amamanamam.hatenablog.com/entry/2023/09/21/192858
- https://zenn.dev/rsugi/articles/8a939d7bd2f60a
- https://zenn.dev/rsugi/articles/886fabb1a8dc03
- https://zenn.dev/rsugi/articles/57114ad5dffc05
- https://speakerdeck.com/rsugi/statuskaramukarasheng-ziruji-shu-de-fu-zhai-tosonojie-jue-ce
