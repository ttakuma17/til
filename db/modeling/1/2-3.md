# 2-3

### 仕様追加
- 期間限定キャンペーン金額を設定できるようにする
  - 期間限定**全品**10%オフ

### 設計意図
- 全品に対する割引キャンペーン管理のためにorder_detailsに紐づけることにした
- 全品に対するキャンペーンであれば、Ordersに紐づけることも考えたが、個別商品やセットメニューに対するキャンペーンが必要になる可能性を踏まえ、order_detailsに紐づけ。
- キャンペーン対象であればorder_details_campaignの中間テーブルにキャンペーンIDと紐づけて保存される

### 変更点
- order_details_campaignとcampaignテーブルを追加

### ER図

```mermaid
---
title: お持ち帰りメニュー ご注文表
---
erDiagram
    customers ||--o{ orders : creates
    customers {
        int id PK
        string name
        string tel
        timestamp created_at
        timestamp updated_at
    }
    orders ||--|{ order_details : contains
    orders { 
        int id PK
        boolean paid
        int payment_total
        int customer_id FK
        timestamp created_at
        timestamp updated_at
    }
    order_details ||--|| products : describes
    order_details {
        int id PK
        int quantity
        int subtotal
        numeric tax
        int order_id FK
        int product_id FK
        timestamp created_at
        timestamp updated_at
    }
    campaign {
        int id PK
        int name
        numeric discount_rate
        timestamp campaign_start
        timestamp campaign_end
        timestamp created_at
        timestamp updated_at
    }
    order_details ||--o{ order_details_campaign : describes
    order_details_campaign }|--|| campaign: includes
    order_details_campaign {
        int id PK
        int order_details_id FK
        int campaign_id FK
        timestamp created_at
        timestamp updated_at
    }
    products {
        int id PK
        string name
        int price
        int product_category_id FK
        timestamp created_at
        timestamp updated_at 
    }
    products }|--|| product_categories : belongsTo
    product_categories {
        int id PK
        string name
        timestamp created_at
        timestamp updated_at
    }
    options {
        int id PK
        string name
        string value
        timestamp created_at
        timestamp updated_at
    }
    order_details ||--o{ order_detail_options: describes
    order_detail_options ||--|{ options: has
    order_detail_options {
        int id PK
        int orders_detail_id FK
        int option_id FK
        timestamp created_at
        timestamp updated_at
    }
```
